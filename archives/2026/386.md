---
title: pnpm 依赖结构
number: '#386'
link: 'https://github.com/tofrankie/blog/issues/386'
created_at: '2026-01-26 02:26:24'
updated_at: '2026-01-26 02:26:24'
labels:
  - '2026'
  - 前端
---
![配图源自 Freepik](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1769365540964.jpg)

## 项目依赖

示例：

```json
{
  "name": "pnpm-demo",
  "version": "1.0.0",
  "dependencies": {
    "alfred-color-converter": "^0.0.11"
  }
}
```

- 项目依赖 `alfred-color-converter`
- `alfred-color-converter` 依赖 `color-convert`
- `color-convert` 依赖 `color-name`

pnpm 依赖目录结构：

- `node_modules/` 仅存放项目的**直接依赖**
- `node_modules/.pnpm/` 该目录下的包是项目目录下**唯一真实**的文件（指向全局 Store 文件）
- `node_modules/.pnpm/node_modules/` 项目所有**间接依赖**都会生成到该目录（类似于 npm/yarn 的扁平依赖结构），该目录下的包都是软链接（指向父级对应包）

> 已有的 npm 生态中很多包已受损，它们使用的依赖项未在其 package.json 中列出。 为了最大限度地减少新用户遇到的问题，pnpm 默认将所有依赖项提升到 `node_modules/.pnpm/node_modules`。可通过 [hoist](https://pnpm.io/settings#hoist) 选项修改此特性。

`tree -a`

```txt
node_modules
├── .pnpm
│   ├── alfred-color-converter@0.0.11
│   │   └── node_modules
│   │       ├── alfred-color-converter
│   │       └── color-convert -> ../../color-convert@2.0.1/node_modules/color-convert
│   ├── color-convert@2.0.1
│   │   └── node_modules
│   │       ├── color-convert
│   │       └── color-name -> ../../color-name@1.1.4/node_modules/color-name
│   ├── color-name@1.1.4
│   │   └── node_modules
│   │       └── color-name
│   └── node_modules
│       ├── color-convert -> ../color-convert@2.0.1/node_modules/color-convert
│       └── color-name -> ../color-name@1.1.4/node_modules/color-name
└── alfred-color-converter -> .pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter
```

> 无论依赖层级有多深，pnpm 构建的依赖目录层级最多到 `node_modules/.pnpm/node_modules/<package>` 这层，避免了扁平化 npm 之前目录层级过深导致的问题。

当使用 `require('alfred-color-converter')` 时，根据 Node.js 的解析策略，找到 `node_modules/alfred-color-converter`（它是软链接），此时 Node.js 会获取到链接文件指向的实际目录，因而访问到 `node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter`。

## peerDependencies

## 全局 Store
