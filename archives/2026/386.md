---
title: pnpm ä¾èµ–ç»“æ„
number: '#386'
link: 'https://github.com/tofrankie/blog/issues/386'
created_at: '2026-01-26 02:26:24'
updated_at: '2026-01-27 05:11:40'
labels:
  - å‰ç«¯
  - '2026'
---
![é…å›¾æºè‡ª Freepik](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1769365540964.jpg)

## é¡¹ç›®ä¾èµ–

### ç¤ºä¾‹

```json
{
  "name": "pnpm-demo",
  "version": "1.0.0",
  "dependencies": {
    "alfred-color-converter": "^0.0.11"
  }
}
```

- é¡¹ç›® `pnpm-demo` ä¾èµ– `alfred-color-converter`
- `alfred-color-converter` ä¾èµ– `color-convert`
- `color-convert` ä¾èµ– `color-name`

åœ¨æ­¤ç¤ºä¾‹ï¼Œé¡¹ç›®ç›´æ¥ä¾èµ–ä¸º `alfred-color-converter`ï¼Œé—´æ¥ä¾èµ–æœ‰ `color-convert` å’Œ `color-name`ã€‚

### ä¾èµ–ç›®å½•

- `node_modules/` ä»…å­˜æ”¾é¡¹ç›®**ç›´æ¥ä¾èµ–**
- `node_modules/.pnpm/` è¯¥ç›®å½•ä¸‹çš„åŒ…æ˜¯é¡¹ç›®ç›®å½•ä¸‹å”¯ä¸€â€œ**çœŸå®**â€çš„æ–‡ä»¶ï¼ˆæŒ‡å‘å…¨å±€ Store æ–‡ä»¶ï¼‰
- `node_modules/.pnpm/node_modules/` é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®æ‰€æœ‰**é—´æ¥ä¾èµ–**éƒ½ä¼šç”Ÿæˆåˆ°è¯¥ç›®å½•ï¼ˆç±»ä¼¼äº npm/yarn çš„æ‰å¹³ä¾èµ–ç»“æ„ï¼‰ï¼Œè¯¥ç›®å½•ä¸‹çš„åŒ…éƒ½æ˜¯è½¯é“¾æ¥ï¼ˆæŒ‡å‘çˆ¶çº§å¯¹åº”åŒ…ï¼‰

### å®Œæ•´ç›®å½•ç»“æ„

`tree -a`

```txt
node_modules
â”œâ”€â”€ .pnpm
â”‚Â Â  â”œâ”€â”€ alfred-color-converter@0.0.11
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ alfred-color-converter
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-convert -> ../../color-convert@2.0.1/node_modules/color-convert
â”‚Â Â  â”œâ”€â”€ color-convert@2.0.1
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ color-convert
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-name -> ../../color-name@1.1.4/node_modules/color-name
â”‚Â Â  â”œâ”€â”€ color-name@1.1.4
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-name
â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â      â”œâ”€â”€ color-convert -> ../color-convert@2.0.1/node_modules/color-convert
â”‚Â Â      â””â”€â”€ color-name -> ../color-name@1.1.4/node_modules/color-name
â””â”€â”€ alfred-color-converter -> .pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter
```

> æ— è®ºä¾èµ–å±‚çº§æœ‰å¤šæ·±ï¼Œpnpm æ„å»ºçš„ä¾èµ–ç›®å½•å±‚çº§æœ€å¤šåˆ° `node_modules/.pnpm/node_modules/<package>` è¿™å±‚ï¼Œé¿å…äº†æ‰å¹³åŒ– npm ä¹‹å‰ç›®å½•å±‚çº§è¿‡æ·±å¯¼è‡´çš„é—®é¢˜ã€‚

1. è¿™ç§ç›®å½•ç»“æ„å®Œå…¨å…¼å®¹ Node.js çš„æ¨¡å—è§£æç®—æ³•
2. åªæœ‰æ˜¾å¼å£°æ˜çš„ç›´æ¥ä¾èµ–æ‰èƒ½åœ¨é¡¹ç›®ä¸­è®¿é—®ï¼Œé¿å…äº†å¹½çµä¾èµ–é—®é¢˜

### ä¾èµ–ç›®å½•ç”Ÿæˆè¿‡ç¨‹

1. å°†ç›´æ¥å’Œé—´æ¥ä¾èµ–ç”Ÿæˆåˆ° `node_modules/.pnpm` ç›®å½•ä¸‹
    - `alfred-color-converter@0.0.11`
    - `color-convert@2.0.1`
    - `color-name@1.1.4`

```txt
node_modules
â””â”€â”€ .pnpm
 Â Â  â”œâ”€â”€ alfred-color-converter@0.0.11 ğŸ†•
 Â Â  â”‚Â Â  â””â”€â”€ node_modules
 Â Â  â”‚Â Â      â””â”€â”€ alfred-color-converter
 Â Â  â”œâ”€â”€ color-convert@2.0.1 ğŸ†•
 Â Â  â”‚Â Â  â””â”€â”€ node_modules
 Â Â  â”‚Â Â      â””â”€â”€ color-convert
 Â Â  â””â”€â”€ color-name@1.1.4 ğŸ†•
 Â Â   Â Â  â””â”€â”€ node_modules
 Â Â   Â Â      â””â”€â”€ color-name
```

> è§‚å¯Ÿå‘ç°ï¼Œ`alfred-color-converter@0.0.11` ä¸ `alfred-color-converter` ä¹‹é—´å¤¹äº†ä¸€å±‚ `node_modules`ï¼Œç›®çš„æ˜¯ï¼š
>
> 1. å…è®¸åŒ…å¯¼å…¥æœ¬èº«ã€‚ä¾‹å¦‚åœ¨ `alfred-color-converter` å†…éƒ¨è°ƒç”¨ `require('alfred-color-converter/package.json')`ï¼Œè¿™ä¸ªæ–¹å¼æ˜¯å…è®¸çš„ã€‚[LOAD_PACKAGE_SELF](https://nodejs.org/api/modules.html#all-together)
> 2. é¿å…å¾ªç¯è½¯é“¾æ¥ã€‚åŒ…çš„ä¾èµ–ä¼šæ”¾åœ¨ä¸ä¾èµ–åŒ…ç›¸åŒçš„ç›®å½•ä¸‹ã€‚åŸºäº Node.js æ¨¡å—è§£æç®—æ³•ï¼Œä¾èµ–æ— è®ºæ”¾åœ¨ `node_modules` è¿˜æ˜¯çˆ¶çº§çš„ `node_modules` ä½œç”¨éƒ½ä¸€æ ·ï¼ŒNode.js éƒ½èƒ½æ‰¾åˆ°ç›®æ ‡åŒ…ã€‚pnpm è¿™æ ·è®¾è®¡ç›®å½•ç»“æ„æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

2. é€šè¿‡è½¯é“¾æ¥çš„æ–¹å¼å…³è”ä¾èµ–é¡¹
    - å°† `node_modules/.pnpm/color-convert@2.0.1/node_modules/color-convert` é“¾æ¥åˆ° `node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/color-convert`
    - å°† `node_modules/.pnpm/color-name@1.1.4/node_modules/color-name` é“¾æ¥åˆ° `node_modules/.pnpm/color-convert@2.0.1/node_modules/color-name`

```txt
node_modules
â””â”€â”€ .pnpm
Â  Â  â”œâ”€â”€ alfred-color-converter@0.0.11
 Â Â  â”‚Â Â  â””â”€â”€ node_modules
 Â Â  â”‚Â Â      â”œâ”€â”€ alfred-color-converter
 Â Â  â”‚Â Â      â””â”€â”€ color-convert -> ../../color-convert@2.0.1/node_modules/color-convert ğŸ†•
 Â Â  â”œâ”€â”€ color-convert@2.0.1
 Â Â  â”‚Â Â  â””â”€â”€ node_modules
 Â Â  â”‚Â Â      â”œâ”€â”€ color-convert
 Â Â  â”‚Â Â      â””â”€â”€ color-name -> ../../color-name@1.1.4/node_modules/color-name ğŸ†•
 Â Â  â””â”€â”€ color-name@1.1.4
 Â Â   Â Â  â””â”€â”€ node_modules
 Â Â   Â Â      â””â”€â”€ color-name
```

3. å¤„ç†ç›´æ¥ä¾èµ–
    - å°† `node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter` é“¾æ¥åˆ° `node_modules/alfred-color-converter`

```txt
node_modules
â”œâ”€â”€ .pnpm
â”‚Â Â  â”œâ”€â”€ alfred-color-converter@0.0.11
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ alfred-color-converter
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-convert -> ../../color-convert@2.0.1/node_modules/color-convert
â”‚Â Â  â”œâ”€â”€ color-convert@2.0.1
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ color-convert
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-name -> ../../color-name@1.1.4/node_modules/color-name
â”‚Â Â  â””â”€â”€ color-name@1.1.4
â”‚Â Â   Â Â  â””â”€â”€ node_modules
â”‚Â Â   Â Â      â””â”€â”€ color-name
â””â”€â”€ alfred-color-converter -> .pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter ğŸ†•
```

4. å°†æ‰€æœ‰é—´æ¥ä¾èµ–åŠå…¶ä¾èµ–ï¼Œæå‡åˆ° `node_modules/.pnpm/node_modules/` ç›®å½•
    - å°† `node_modules/.pnpm/color-convert@2.0.1/node_modules/color-convert` é“¾æ¥åˆ° `node_modules/.pnpm/node_modules/color-convert`
    - å°† `node_modules/.pnpm/color-name@1.1.4/node_modules/color-name` é“¾æ¥åˆ° `node_modules/.pnpm/node_modules/color-name`

```txt
node_modules
â”œâ”€â”€ .pnpm
â”‚Â Â  â”œâ”€â”€ alfred-color-converter@0.0.11
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ alfred-color-converter
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-convert -> ../../color-convert@2.0.1/node_modules/color-convert
â”‚Â Â  â”œâ”€â”€ color-convert@2.0.1
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ color-convert
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-name -> ../../color-name@1.1.4/node_modules/color-name
â”‚Â Â  â”œâ”€â”€ color-name@1.1.4
â”‚Â Â  â”‚Â Â  â””â”€â”€ node_modules
â”‚Â Â  â”‚Â Â      â””â”€â”€ color-name
â”‚Â Â  â””â”€â”€ node_modules ğŸ†•
â”‚Â Â      â”œâ”€â”€ color-convert -> ../color-convert@2.0.1/node_modules/color-convert
â”‚Â Â      â””â”€â”€ color-name -> ../color-name@1.1.4/node_modules/color-name
â””â”€â”€ alfred-color-converter -> .pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter
```

> å—æ‰å¹³åŒ– `node_modules` ç»“æ„çš„å½±å“ï¼Œnpm ç”Ÿæ€ä¸­å¾ˆå¤šåŒ…æœªæ­£ç¡®ä½¿ç”¨ä¾èµ–ï¼Œå…¶ä¾èµ–é¡¹æœªåœ¨å…¶ `package.json` ä¸­åˆ—å‡ºã€‚æ—¢ç„¶å·²æˆäº‹å®ï¼Œä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘æ–°ç”¨æˆ·é‡åˆ°çš„é—®é¢˜ï¼Œpnpm é»˜è®¤å°†æ‰€æœ‰ä¾èµ–é¡¹æå‡åˆ° `node_modules/.pnpm/node_modules`ã€‚å¯é€šè¿‡ [hoist](https://pnpm.io/settings#hoist) é€‰é¡¹ä¿®æ”¹æ­¤ç‰¹æ€§ã€‚

### Node.js æ¨¡å—è§£æ

> By default, when Node.js loads a module from a path that is symbolically linked to a different on-disk location, Node.js will dereference the link and use the actual on-disk "real path" of the module as both an identifier and as a root path to locate other dependency modules. [--preserve-symlinks](https://nodejs.org/docs/v24.13.0/api/cli.html#--preserve-symlinks)

> é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js é‡åˆ°è½¯é“¾æ¥ä¼šä½¿ç”¨ `fs.realpathSync()` è·å–å…¶çœŸæ­£è·¯å¾„ã€‚[toRealPath](https://github.com/nodejs/node/blob/d14b484c73ff15010e51b0f290845306b0443d47/lib/internal/modules/cjs/loader.js#L767)

åŸºäº pnpm ç‰¹æ®Šçš„ä¾èµ–ç»“æ„ï¼Œå…¶ä¾èµ–è®¿é—®é¡ºåºå¦‚ä¸‹ï¼š

1. åœ¨é¡¹ç›® `index.js` ä¸­è®¿é—® `require('alfred-color-converter')`
   æ ¹æ® Node æ¨¡å—è§£æç®—æ³•ï¼Œæ‰¾åˆ° `project/node_modules/alfred-color-converter`ï¼ˆè½¯é“¾æ¥ï¼‰ï¼ŒNode æ‰¾åˆ°çœŸæ­£çš„ç›®å½•ä½ç½® `project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter`ï¼Œæ¥ç€æ ¹æ® `exports`ã€`main` æŸ¥æ‰¾è§„åˆ™æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚
2. æ¥ç€ï¼Œ`alfred-color-converter` åŒ…å†…éƒ¨ï¼ˆå‡è®¾æ˜¯ `dist/index.js`ï¼‰è®¿é—®äº† `require('color-convert')`ã€‚æ³¨æ„ï¼Œ`require` çš„è§£æèµ·ç‚¹æ˜¯â€œå½“å‰æ¨¡å—çš„æ–‡ä»¶è·¯å¾„â€ï¼Œä¹Ÿå°±æ˜¯ `project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter/dist/index.js`ã€‚å› æ­¤ Node æœ€ç»ˆè§£æåˆ° `project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/color-convert`ï¼ˆè½¯é“¾æ¥ï¼‰ï¼ŒNode æ‰¾åˆ°çœŸæ­£çš„ç›®å½•ä½ç½® `project/node_modules/.pnpm/color-convert@2.0.1/node_modules/color-convert`ã€‚
3. åŒç†ï¼Œåœ¨ `color-convert` åŒ…å†…éƒ¨ï¼ˆå‡è®¾æ˜¯ `dist/index.js`ï¼‰è®¿é—® `require('color-name')`ï¼ŒNode é€šè¿‡ `project/node_modules/.pnpm/color-convert@2.0.1/node_modules/color-name`ï¼ˆè½¯é“¾æ¥ï¼‰æ‰¾åˆ°çœŸæ­£çš„æ–‡ä»¶ `project/node_modules/.pnpm/color-name@1.1.4/node_modules/color-name`ã€‚

ä¼ªä»£ç ï¼š

```bash
# åœ¨é¡¹ç›® index.js è®¿é—® require('alfred-color-converter')
project/index.js
project/node_modules/alfred-color-converter
project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter

# åœ¨ alfred-color-converter çš„ dist/index.js è®¿é—® require('color-convert')
project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/alfred-color-converter/dist/index.js
project/node_modules/.pnpm/alfred-color-converter@0.0.11/node_modules/color-convert
project/node_modules/.pnpm/color-convert@2.0.1/node_modules/color-convert

# åœ¨ color-convert çš„ dist/index.js è®¿é—® require('color-name')
project/node_modules/.pnpm/color-convert@2.0.1/node_modules/color-convert/dist/index.js
project/node_modules/.pnpm/color-convert@2.0.1/node_modules/color-name
project/node_modules/.pnpm/color-name@1.1.4/node_modules/color-name
```

å¯¹äºé‚£äº›ä½¿ç”¨å¹½çµä¾èµ–çš„åŒ…ï¼ˆæ¯”å¦‚ `foo@1.0.0` ä½¿ç”¨äº† `bar@1.0.0`ï¼‰ï¼Œç”±äº `bar` æœªåœ¨ `foo` çš„ `package.json` åˆ—å‡ºï¼Œå› æ­¤ pnpm ä¸ä¼šåœ¨ `project/node_modules/.pnpm/foo@1.0.0/node_modules` ç›®å½•åˆ›å»º `bar` åŒ…çš„è½¯é“¾æ¥ã€‚æ­¤æ—¶ï¼Œå½“åœ¨ `foo` å†…éƒ¨è®¿é—® `require('bar')` æ—¶ï¼ŒåŸºäº Node çš„æ¨¡å—è§£æç®—æ³•ï¼Œä¼šæ‰¾åˆ° `project/node_modules/.pnpm/node_modules` è¿™å±‚ï¼ˆæ‰€æœ‰é—´æ¥ä¾èµ–éƒ½ä¼šåœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºè½¯é“¾æ¥ï¼‰ï¼Œå®ƒæ‰¾åˆ° `project/node_modules/.pnpm/node_modules/foo`ï¼ˆè½¯é“¾æ¥ï¼‰ï¼Œè¿›è€Œè®¿é—® `project/node_modules/.pnpm/foo@1.0.0/node_modules/foo`ã€‚æ‰€ä»¥ pnpm è¿™ç§ç›®å½•ç»“æ„è®¾è®¡å¯ä»¥å…¼å®¹åˆ°å¹½çµä¾èµ–çš„åŒ…ã€‚

## peerDependencies

## å…¨å±€ Store
