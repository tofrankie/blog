---
title: tsconfig.json 详解
number: '#308'
link: 'https://github.com/tofrankie/blog/issues/308'
created_at: '2023-03-25 22:16:58'
updated_at: '2026-01-13 01:09:45'
labels:
  - TS
  - 尚未完结
  - '2023'
---
## 一、简介

`tsconfig.json` 是 TypeScript 编译器的配置文件，用于指定编译 TypeScript 代码时的编译选项和编译目标等信息。通过修改该文件，可以定制 TypeScript 编译器的行为，例如指定编译目标、启用或禁用特定的语言特性、设置代码检查规则等。

### 1.1 与 jsconfig.json 的关系

`jsconfig.json` 源自 `tsconfig.json`，默认启用了一些与 JavaScript 相关的编译选项，常用于 JavaScript 项目。可以简单理解为设置了 `allowJs` 为 `true` 的 `tsconfig.json`。

比如，当我们使用 [Webpack Alias](https://webpack.js.org/configuration/resolve/#resolvealias) 时，可以往 `jsconfig.json` 里添加 `baseUrl`、`paths` 配置以获得路径智能提示，提高开发体验。

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### 1.2 创建 tsconfig.json

方式有二。一是利用 `tsc --init` 命令添加（[详见](https://www.typescriptlang.org/docs/handbook/compiler-options.html#compiler-options)）。

```shell
$ cd /path/to/project
$ npm init -y
$ npm i typescript -D
$ npx tsc --init

Created a new tsconfig.json with:                                                       
  target: es2016
  module: commonjs
  strict: true
  esModuleInterop: true
  skipLibCheck: true
  forceConsistentCasingInFileNames: true


You can learn more at https://aka.ms/tsconfig
```

二是手动添加，然后参考 [TSConfig bases](https://github.com/tsconfig/bases#centralized-recommendations-for-tsconfig-bases)，借鉴各种框架的配置示例，也可直接安装对应 `@tsconfig/xxx` 包并使用 `extends` 继承配置。

### 1.3 选择编译配置

通常，若目录下存在 `tsconfig.json` 文件，则表示该目录是 TypeScript 项目的根目录。尽管如此，在用法上还是要注意。

```shell
# 1️⃣
$ tsc

# 2️⃣
$ tsc index.ts

# 3️⃣
$ tsc --project /path/to/your_tsconfig.json
```

以上三种方式，编译时的配置稍有不同：

- 1️⃣ 无输入文件的情况下调用 `tsc`，编译器会从当前目录开始并逐级向上检索 `tsconfig.json` 文件作为其编译配置。若一直找不到，则使用默认配置。
- 2️⃣ 有输入文件的情况下调用 `tsc`，编辑器将会使用默认配置。
- 3️⃣ 指定 `--project` 或 `-p` 参数情况下调用 `tsc`，编译器将会使用该路径下的配置文件。

如果你是刚接触，可参考 [TSConfig bases](https://github.com/tsconfig/bases#centralized-recommendations-for-tsconfig-bases) 选择适合你所用框架的配置。

### 1.4 配置优先级

CLI Options > 项目 tsconfig.json 配置 > 默认配置

## 二、顶层选项

> tsconfig.json 配置选项非常多，超过 100 个。

顶层选项有：

```json
{
  "compileOnSave": true,
  "vueCompilerOptions": {},
  "compilerOptions": {},
  "watchOptions": {},
  "include": [],
  "exclude": [],
  "files": [],
  "typeAcquisition": {},
  "references": [],
  "extends": [],
  "buildOptions": {},
  "ts-node": {}
}
```

还包括 Vue.js 中会用到的 vueCompilerOptions 选项等。

### 2.1 compileOnSave

启用该选项，可以让 IDE/Editor 在保存文件时自动编译。

**请注意，它（目前）并没有得到 Visual Studio Code 的支持**。仅在 Visual Studio 2015 和安装了 [atom-typescript](https://github.com/TypeStrong/atom-typescript#installation) 插件的 [Atom](https://atom.io/) 中得到了支持。而该插件和 Atom 均已停止维护。

### 2.2 compilerOptions

该选项是 TypeScript 配置的重头戏，下文再详细介绍。

### 2.3 files

该选项用于指定待编译的文件，接受一个字符串数组，可以是相对路径或绝对路径，但不能是 Glob 模式。

注意点：

- 如果指定了 `files` 选项，则只有指定的文件才会被编译，其他文件会被忽略；
- 如果 `files` 内指定的文件引用了其他模块，这些模块也会被编译。
- 当使用了 `files` 选项，通常还会指定 `compilerOptions.outFile` 或 `compilerOptions.outDir` 选项以便编译器将编译结果输出到指定文件中。
- 如果指定了 `files`，`include` 的默认值为 `[]`，否则为 `["**"]`。

### 2.4 include

该选项类似于 `files` 字段，同样用于指定编译器应该包含哪些文件进行编译，未指定时默认编译根目录下所有 TypeScript 文件。区别在于，`include` 支持 Glob 模式来指定文件路径。

`include` 和 `exclude` 支持 Glob 模式如下：

- `*` 匹配零个或多个字符（除了路径分隔符 `/`）。
- `?` 匹配一个字符（除了路径分隔符 `/`）。
- `**/` 匹配零个或多个目录及其子目录。

若 Glob 模式未指定文件扩展名时，默认支持 `.ts`、`.tsx` 和 `.d.ts`。若 `allowJs` 为 `true`，还包括 `.js` 和 `.jsx`。

### 2.5 exclude

该选项用于指定 `include` 里面需要忽略的文件。exclude 的默认值为 `["node_modules", "bower_components", "jspm_packages"]`，但排除文件还包括 `outDir` 指定值。

以下示例将会忽略的文件为 `["node_modules", "bower_components", "jspm_packages", "dist"]`。

```json
{
  "compilerOptions": {
    "outDir": "dist"
  },
  "exclude": []
}
```

> 请注意，`exclude` 字段只影响由 `include` 字段指定的文件和目录中包含哪些文件，而不会完全排除在 `exclude` 中列出的文件。也就是说，如果一个文件在 `exclude` 中列出，但是它被代码中的 `import` 语句、`/// <reference` 或者在 `files`、`types` 字段中的文件中引用，那么这个文件仍然会被编译。

### 2.6 files、include 和 exclude 的关系

TS 到底是如何决定要编译哪些文件？

1. 收集候选文件
2. 应用排除规则
3. 形成最终编译文件夹

不是简单的 `files + include - exclude`，而是：

```
1️⃣ 如果存在 files
   → 直接使用 files 指定的文件
   → include / exclude 不参与

2️⃣ 如果不存在 files
   → 使用 include（或默认 include）
   → 再应用 exclude
```

- files - 准确指定参与编译的文件路径，不支持 Glob 形式。一般不直接使用该选项。
- include - 指定参与编译的文件范围，通常是 Glob 形式。
- exclude - 排除 include 范围内的黑名单文件。如果 include 中白名单文件引用了黑名单文件，这个黑名单文件最终也会参与到编译。

### 2.7 references

`references` 是 TS 3.0 的一项新功能，详见 [Project References](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-0.html#project-references)。

它的优点是大幅提升构建时间，并以更好的方式组织代码。

现在，一个现代工程化的 Web 项目，除了业务代码外，少不了各种构建脚本、测试文件等。它们运行运行环境不同，比如 Web 的宿主环境是浏览器，而构建工具、测试文件的宿主环境是 Node.js。不同的宿主环境，其 tsconfig.json 配置是不同的，比如浏览器环境需要 `lib: ["ES2022", "DOM"]`，而 Node.js 环境则是 `lib: ["ES2022"]` + `types: ["node"]`。为了在一个项目既支持浏览器环境、Node.js 我们可能要做出这样的选择 `lib: ["ES2022", "DOM"]` + `types: ["node"]`，但这样是有风险的，如果在业务代码中导入了 Node.js 的 API，由于 TS 配置的原因，编译时是 OK 的，但运行时就可能会运行错误。

使用 `references` 可以使用新的组织方式来解决这个问题。

以 Vite + [react-ts](https://vite.new/react-ts) 模板为例，它包含了三个文件：

- `tsconfig.ts` - 它只是调度器，不产出 JS 或类型声明文件
- `tsconfig.app.ts` - 浏览器环境，通过 `include` 选项关联文件范围，比如 `src`
- `tsconfig.node.ts` - Node 环境，通过 `include` 选项关联文件范围，比如 `vite.config.ts`

> 假设引用的子配置是可以单独构建的，需在子配置中指定 `composite` 为 `true`

这样浏览器环境和 Node.js 环境就不会混淆了，TS 可以识别到，当在业务代码使用 Node.js 的 API 就可以看到编译错误了，反之亦然。

▼ tsconfig.js
```ts
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
```

▼ tsconfig.app.js
```ts
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
```

▼ tsconfig.node.js
```ts
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
```

未完待续...

## 三、参考链接

- [What is jsconfig.json?](https://code.visualstudio.com/docs/languages/jsconfig)
- [What is a tsconfig.json?](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html)
- [TSConfig Reference](https://www.typescriptlang.org/tsconfig)
- [tsc CLI Options](https://www.typescriptlang.org/docs/handbook/compiler-options.html)
