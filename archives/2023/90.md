---
title: ä»é›¶åˆ°ä¸€æ­å»ºç§æœ‰ NPM æœåŠ¡å™¨
number: '#90'
link: 'https://github.com/tofrankie/blog/issues/90'
created_at: '2023-02-25 20:21:23'
updated_at: '2026-01-02 04:38:34'
labels:
  - Node.js
  - '2021'
---
![é…å›¾æºè‡ª Freepik](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2023/10/1696416482980.png)

æˆ‘ä»¬çŸ¥é“ [npmjs.com](https://www.npmjs.com/) å¹³å°ä¸Šçš„ package å¯¹ä»»ä½•äººéƒ½æ˜¯å¼€æ”¾çš„ï¼Œå¯ä»¥éšæ„å®‰è£…ã€‚

å‡è®¾å…¬å¸/å›¢é˜Ÿæƒ³æŠŠä¸€äº›å¯å¤ç”¨çš„æ¨¡å—åšæˆ NPM åŒ…ï¼Œä½†ç”±äºæ¶‰åŠå…¬å¸ä¸šåŠ¡çš„åŸå› ï¼Œä¸èƒ½å‘å¸ƒåˆ°åƒ NPM è¿™ç§å…¬å¼€å¹³å°ã€‚æ­¤æ—¶ï¼Œå¯ä»¥åœ¨å…¬å¸å†…éƒ¨å»ºç«‹ä¸€ä¸ªç§æœ‰çš„ NPM å¹³å°ã€‚

æˆ‘ä»¬ä»é›¶åˆ°ä¸€æ­å»ºä¸ªäººçš„ NPM ç§æœ‰æœåŠ¡å™¨ã€‚

## ä¸€ã€é€‰æ‹©

é€‰æ‹© [Verdaccio](https://github.com/verdaccio/verdaccio) ä½œä¸ºæˆ‘ä»¬ç§æœ‰ NPM ä»“åº“çš„å¹³å°ï¼Œä¸»è¦åŸå› æ˜¯å…è´¹ã€é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨ã€‚

> å¦‚æœæ˜¯å…¬å¸å±‚é¢ï¼Œå¯èƒ½è¦æ·±å…¥å¯é ã€ç¨³å®šæ€§ç­‰å› ç´ ã€‚

## äºŒã€NPM å¹³å°æ­å»º

å®‰è£…ã€å¯åŠ¨éƒ½éå¸¸ç®€å•~

```shell
# install
$ npm i -g verdaccio

# run
$ verdaccio

 warn --- config file  - /Users/frankie/.config/verdaccio/config.yaml
 warn --- Plugin successfully loaded: verdaccio-htpasswd
 warn --- Plugin successfully loaded: verdaccio-audit
 warn --- http address - http://localhost:4873/ - verdaccio/5.1.1
 http --- 127.0.0.1 requested 'GET /'
 http --- 304, user: null(127.0.0.1), req: 'GET /', bytes: 0/0
 http --- 127.0.0.1 requested 'GET /-/verdaccio/packages'
 http --- 304, user: null(127.0.0.1), req: 'GET /-/verdaccio/packages', bytes: 0/0
```

Verdaccio è·‘èµ·æ¥ä¹‹åï¼Œå°±å¯ä»¥è®¿é—® `http://localhost:4873/`ï¼ˆä»“åº“åœ°å€ï¼‰äº†ã€‚

é…ç½®æ–‡ä»¶åœ¨ `~/.config/verdaccio/config.yaml`ã€‚

ç›®å‰è¿˜æ²¡å‘å¸ƒè¿‡åŒ…ï¼Œé•¿è¿™æ ·...

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767298167232.png)

æˆ‘ä»¬ä½¿ç”¨ [nrm](https://github.com/tofrankie/blog/issues/89) åˆ‡æ¢é•œåƒæºï¼š

```shell
# æ·»åŠ ç§æœ‰æºï¼Œæºåç§° local å¯è‡ªå®šä¹‰ï¼ŒæŒ‰éœ€ä½¿ç”¨
$ nrm add local http://localhost:4873/

# åˆ‡æ¢æº
$ nrm use local

# æ³¨å†Œç”¨æˆ·ï¼Œå¯¹åº”ä½  NPM è´¦å·å¯†ç 
$ npm adduser

# æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯æ³¨å†Œç”¨æˆ·
$ npm who am i
```

## ä¸‰ã€å‘åŒ…

### 3.1 åˆ›å»º NPM é¡¹ç›®

æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ NPM åŒ…é¡¹ç›®ï¼Œç›®å½•å¦‚ä¸‹ï¼š

```text
privative-npm
â”œâ”€â”€ .gitignore                # ç›¸åº”ç›®å½•ï¼Œå‘å¸ƒæ—¶ä¼šå¿½ç•¥ä¸Šä¼ 
â”œâ”€â”€ .npmignore                # åŒç†ï¼Œä¼šå¿½ç•¥ä¸Šä¼ 
â”œâ”€â”€ index.js                  # ä½œä¸ºå…¥å£
â”œâ”€â”€ package.json              # åŒ…æè¿°æ–‡ä»¶
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

ä¸€ä¸ª NPM åŒ…ï¼Œå…¶ä¸­ `name` å’Œ `version` æ˜¯å¿…éœ€çš„ï¼Œå…¶ä»–éƒ½å¯ä»¥çœç•¥ï¼Œè€Œä¸” name ä¸èƒ½ä¸å¹³å°ä¸Šå·²æœ‰åŒ…é‡åã€‚

```json5
// package.json
{
  "name": "privative-npm", // å¿…éœ€ï¼Œä¸èƒ½æœ‰å¤§å†™å­—æ¯ã€ç©ºæ ¼ã€ä¸‹åˆ’çº¿
  "version": "1.0.0", // å¿…éœ€ï¼Œè¯·ä¸¥æ ¼éµå¾ªè¯­ä¹‰åŒ–
  "description": "Test only, not published to NPM.",
  "author": "Frankie <1426203851@qq.com>",
  "license": "MIT",
  "type": "module",
  "main": "./index.js"
}
```

ç”±äºä»…æ¼”ç¤ºç”¨ï¼Œç®€å•å¤„ç†å¯¼å‡ºä¸€ä¸ªæ–¹æ³•ã€‚

```js
// index.js
export default function log(str) {
  console.log(str)
}
```

### 3.2 å‘å¸ƒ NPM åŒ…

åœ¨å‘åŒ…ä¹‹å‰ï¼Œä½ éœ€è¦å» [npmjs.com](https://www.npmjs.com/) æ³¨å†Œä¸€ä¸ªè´¦å·ï¼ˆå·²æœ‰è·³è¿‡ï¼‰ã€‚

ç™»å½•ä½ çš„ NPM è´¦å·ï¼š

```shell
# add registry
$ nrm add local http://localhost:4873/

# switch registry
$ nrm use local

# é¦–æ¬¡éœ€è¦æ·»åŠ ç”¨æˆ·ï¼ŒåŒ…æ‹¬äº†ç™»å½•æ“ä½œ add npm account
$ npm adduser

# å·²æ·»åŠ è¿‡ç”¨æˆ·ï¼Œç›´æ¥ç”¨ login
$ npm login
```

> æ­¤å¤„æ·»åŠ  local æºåï¼Œä¸‹æ–‡å°†ä¼šç›´æ¥ä½¿ç”¨ `nrm use local` åˆ‡æ¢è‡³ `http://localhost:4873/` æºã€‚

ä»¥ä¸‹ç™»å½•æˆåŠŸï¼š

```shell
$ npm login

Username: xxx
Password: 
Email: (this IS public) example@gmail.com
Logged in as xxx on http://localhost:4873/.
```

é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ `npm publish` è¿›è¡Œå‘ç‰ˆã€‚

> é€šå¸¸ä¼šåœ¨ `package.json` å®šä¹‰ prepublish å‘½ä»¤ï¼Œå¯èƒ½ä¼šä¼´éšç€æ„å»ºã€æµ‹è¯•ç­‰æµç¨‹ä»¥ç¡®ä¿æ— è¯¯ã€‚

```shell
$ npm publish

npm notice 
npm notice ğŸ“¦  privative-npm@1.0.0
npm notice === Tarball Contents === 
npm notice 54B  index.js    
npm notice 212B package.json
npm notice 36B  README.md   
npm notice === Tarball Details === 
npm notice name:          privative-npm                           
npm notice version:       1.0.0                                   
npm notice package size:  416 B                                   
npm notice unpacked size: 302 B                                   
npm notice shasum:        887836aa4a154902faf31b13e60b8adcdd07b924
npm notice integrity:     sha512-fyzitNqmif188[...]hFY+zmcIW6qTg==
npm notice total files:   3                                       
npm notice 
+ privative-npm@1.0.0
```

ä¸Šä¼ æˆåŠŸåˆ·æ–°é¡µé¢ï¼š

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767298203011.png)

### 3.3 æ›´æ–°åŒ…

å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œç‰ˆæœ¬å· `version` ä¸€å®šè¦ä¿®æ”¹ï¼Œå¦åˆ™å‘å¸ƒä¼šå¤±è´¥ï¼Œæ¯”å¦‚ï¼š

```shell
$ npm publish

...
npm ERR! code EPUBLISHCONFLICT
npm ERR! publish fail Cannot publish over existing version.
npm ERR! publish fail Update the 'version' field in package.json and try again.
npm ERR! publish fail 
npm ERR! publish fail To automatically increment version numbers, see:
npm ERR! publish fail     npm help version

npm ERR! A complete log of this run can be found in:
npm ERR!     /Users/frankie/.npm/_logs/2021-07-14T06_16_31_553Z-debug.log
```

åªæ˜¯æ¼”ç¤ºæ›´æ–°æ“ä½œï¼Œæˆ‘åªæ”¹ä¸ªç‰ˆæœ¬å·ã€‚ä»ç„¶ä½¿ç”¨ `npm publish` å‘å¸ƒï¼Œåˆ·æ–°é¡µé¢ï¼š

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767298388295.png)

> ç‰ˆæœ¬å·åº”è¯¥éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://github.com/tofrankie/blog/issues/83)åŸåˆ™è¿›è¡Œæ›´æ–°ã€‚

> å¯¹äºä½¿ç”¨åŒ…çš„è§’åº¦æ¥è¯´ï¼Œç”±äºç‰ˆæœ¬æ§åˆ¶åªæ˜¯ä¸€ç§çº¦å®šï¼Œæ¯ä¸ªå…·ä½“é¡¹ç›®çš„è§£è¯»å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› æ­¤ä½ ä¸åº”ç›²ç›®ä¿¡ä»»å®ƒã€‚

### 3.4 æ’¤é”€åŒ…

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ NPM å¹³å°æ’¤é”€åŒ…æ˜¯ä¸¥æ ¼é™åˆ¶çš„ï¼Œä¸å…è®¸éšæ„æ’¤é”€å·²å‘å¸ƒåŒ…ï¼Œè¯¦è§ [NPM Unpublish Policy](https://www.npmjs.com/policies/unpublish)ã€‚

```shell
# æ’¤é”€åŒ…çš„æŸä¸ªç‰ˆæœ¬
$ npm unpublish [<@scope>/]<package>@<version>

# æ’¤é”€åŒ…
$ npm unpublish [<@scope>/]<package>
```

å¦‚æœä½ çš„ç›®çš„æ˜¯é¼“åŠ±ç”¨æˆ·å‡çº§ï¼Œæˆ–è€…ä½ ä¸æƒ³å†ç»´æŠ¤è½¯ä»¶åŒ…ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ `deprecate` å‘½ä»¤ã€‚

```shell
$ npm deprecate <pkg>[@<version>] <message>
```

æˆ‘ä»¬åœ¨å®‰è£…ä¸€äº›ä¾èµ–åŒ…çš„æ—¶å€™ï¼Œä¸æ˜¯ç»å¸¸çœ‹å¾—åˆ°ç±»ä¼¼çš„ä¸œè¥¿å—ï¼Œå°±æ˜¯ `deprecate` æçš„é¬¼~

```shell
npm WARN deprecated core-js@1.2.7: core-js@<3.3 is no longer maintained and not recommended for usage due to the number of issues.
```

## å››ã€ä½¿ç”¨åŒ…

å‰é¢æˆ‘ä»¬å°† `privative-npm` åŒ…å‘å¸ƒåˆ°æœ¬åœ°ç§æœ‰çš„ NPM æœåŠ¡å™¨ä¸‹ï¼Œè¦å®‰è£…æ­¤åŒ…ï¼Œè¦åˆ‡æ¢è‡³ local é•œåƒæºï¼š

```shell
$ nrm use local
```

åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå®‰è£… `privative-npm` åŒ…ï¼Œå†™ä¸€ä¸ªè„šæœ¬æ‰§è¡Œçœ‹åˆ°ç»“æœç¬¦åˆé¢„æœŸçš„ã€‚

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767299109490.png)

## äº”ã€ä¾èµ–å®‰è£…æµç¨‹

åœ¨ä½¿ç”¨ `http://localhost:4873/` é•œåƒæºæ—¶ï¼Œè¦å®‰è£… `react`ã€`vue` ç­‰åŒ…ï¼Œå†…éƒ¨æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæ­£å¸¸ä½¿ç”¨ NPM å®‰è£…ã€å…±äº«ã€å‘åŒ…çš„æµç¨‹ï¼š

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767299462791.png)
â–² å›¾ç‰‡æºè‡ªåä¸‰æœˆ

ä½¿ç”¨ npm å»å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼Œå…ˆæ£€æŸ¥ `node_modules` ç›®å½•æ˜¯å¦å·²ç»ç¼“å­˜äº†è¯¥æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰ä¾¿ä¼šå‘ NPM å¹³å°æŸ¥è¯¢ã€‚

NPM æä¾›äº†ä¸€ä¸ªæ¨¡å—ä¿¡æ¯æŸ¥è¯¢æœåŠ¡ï¼Œé€šè¿‡è®¿é—®ï¼š

```
registry.npmjs.org/packaename/version
```

å°±å¯ä»¥æŸ¥åˆ°æŸä¸ªå‘å¸ƒåœ¨ NPM å¹³å°ä¸Šæ¨¡å—çš„å…·ä½“ä¿¡æ¯ï¼Œä»¥åŠä¸‹è½½åœ°å€ã€‚ç„¶åä¸‹è½½å¹¶è§£å‹åˆ°æœ¬åœ°å®Œæˆå®‰è£…ã€‚

**å¦‚æœæˆ‘ä»¬å¯ç”¨äº†ç§æœ‰ NPM æœåŠ¡å™¨ï¼Œæµç¨‹åˆæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿ**

![](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2026/1/1767299521382.png)
â–² å›¾ç‰‡æºè‡ªâ€œåä¸‰æœˆâ€

Verdaccio çš„é»˜è®¤é…ç½®æ–‡ä»¶åœ¨ `~/.config/verdaccio/config.yaml`

```yaml
#
# é…ç½®æ–‡ä»¶ï¼ˆè¿™é‡Œæˆ‘åˆ é™¤äº†ä¸€äº›é»˜è®¤æ³¨è§£ï¼‰
# æ›´å¤šè¯·çœ‹: https://github.com/verdaccio/verdaccio/blob/master/packages/config/src/conf/default.yaml
#

# ä¸Šä¼ çš„æ‰€æœ‰åŒ…å­˜æ”¾ç›®å½•
storage: ./storage
# æ’ä»¶ç›®å½•
plugins: ./plugins

# web æœåŠ¡ï¼Œå³æˆ‘ä»¬å¯ä»¥é€šè¿‡ web æŸ¥çœ‹æˆ‘ä»¬ä¸Šä¼ çš„åŒ…ã€‚
web:
  title: Verdaccio
  # ä¸€äº›å…³äº web é¡µé¢çš„é…ç½®é¡¹ï¼Œæˆ‘åˆ æ‰äº†

# éªŒè¯ä¿¡æ¯
auth:
  htpasswd:
    # ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ç›®å½•
    file: ./htpasswd

# å…¬æœ‰ä»“åº“é…ç½®
uplinks:
  npmjs:
    # é»˜è®¤
    # url: https://registry.npmjs.org/
    # å¯ä»¥æ”¹æˆæ·˜å®é•œåƒæº
    url: https://registry.npmmirror.com/

packages:
  '@*/*':
    # scoped packages
    access: $all
    publish: $authenticated
    unpublish: $authenticated
    # ä»£ç†ã€‚å½“æˆ‘ä»¬å®‰è£…ä¸€äº›ç§æœ‰æœåŠ¡å™¨ä¸Šæ²¡æœ‰çš„åŒ…æ—¶ï¼Œå®ƒå°±ä¼šå¾€è¿™é‡Œæ‰¾ï¼Œå³ä¸Šé¢çš„ uplinks é…ç½®
    proxy: npmjs

  '**':
    # ä¸‰ç§è§’è‰²ï¼šæ‰€æœ‰äººã€åŒ¿åç”¨æˆ·ã€è®¤è¯ï¼ˆç™»å½•ï¼‰ç”¨æˆ·
    # "$all", "$anonymous", "$authenticated"

    # å¯è®¿é—®åŒ…è§’è‰²
    access: $all

    # å¯å‘åŒ…ã€æ’¤åŒ…è§’è‰²
    publish: $authenticated
    unpublish: $authenticated

    # if package is not available locally, proxy requests to 'npmjs' registry
    proxy: npmjs

# æœåŠ¡è¿æ¥æ´»è·ƒæ—¶é—´
server:
  keepAliveTimeout: 60

middlewares:
  audit:
    enabled: true
```

## å…­ã€å‚è€ƒé“¾æ¥

- [å‰ç«¯è¿ç»´éƒ¨ç½²é‚£äº›äº‹](https://zhuanlan.zhihu.com/p/368784910)
- [å¦‚ä½•æ­å»ºä¸€ä¸ªç§æœ‰ npm æœåŠ¡å™¨](http://auan.cn/internet/2010.html)
- [å†™ç»™å‰ç«¯å·¥ç¨‹å¸ˆçœ‹çš„è¿ç»´å’Œæ¶æ„](https://www.cnblogs.com/scoluo/p/7453485.html)
- [ä½ çœŸçš„æ‡‚ npm publish ï¼Ÿ](https://juejin.cn/post/6844904037377114119)
