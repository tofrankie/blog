---
title: 梳理 node、npm、yarn、pnpm 相关路径
number: '#94'
link: 'https://github.com/tofrankie/blog/issues/94'
created_at: '2023-02-25 20:27:18'
updated_at: '2026-01-29 03:14:38'
labels:
  - Node.js
  - '2022'
---
![配图源自 Freepik](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2025/12/1767110239450.png)

如果你对 node、npm、yarn、pnpm 全局安装路径存疑，混乱分不清，那么这篇文章或许能帮到你。

> 本文以 macOS 为例

## 一、Node 路径

使用 `which` 命令可以查看可执行文件的路径。

需要注意的是，不同的安装方式其路径是有差异的。

使用 [.pkg](https://nodejs.org/en/download/) 形式安装的 Node.js

```bash
$ which node npm yarn pnpm
/usr/local/bin/node
/usr/local/bin/npm
/usr/local/bin/yarn
/usr/local/bin/pnpm
```

使用 Homebrew 安装的 Node.js

```bash
$ which node npm yarn pnpm
/usr/local/opt/node@22/bin/node
/usr/local/opt/node@22/bin/npm
/usr/local/opt/node@22/bin/yarn
/usr/local/opt/node@22/bin/pnpm

# ARM Mac
$ which node npm yarn pnpm
/opt/homebrew/opt/node@22/bin/node
/opt/homebrew/opt/node@22/bin/npm
/opt/homebrew/opt/node@22/bin/yarn
/opt/homebrew/opt/node@22/bin/pnpm
```

使用 nvm 安装的 Node.js

```bash
$ which node npm yarn pnpm
~/.nvm/versions/node/v22.18.0/bin/node
~/.nvm/versions/node/v22.18.0/bin/npm
~/.nvm/versions/node/v22.18.0/bin/yarn
~/.nvm/versions/node/v22.18.0/bin/pnpm
```

## 二、npm 路径

### 缓存目录

使用 `npm install` 安装依赖时，包都会下载至全局缓存目录 `~/.npm`。全局依赖或项目依赖都是从这个缓存目录中拷贝出来的。

```bash
$ npm config get cache
~/.npm
```

> [A note about the cache's design](https://docs.npmjs.com/cli/v10/commands/npm-cache#a-note-about-the-caches-design)

清空缓存

```bash
$ npm cache clean
```

### 全局依赖

安装全局依赖步骤（[详见](https://docs.npmjs.com/cli/v10/commands/npm-install#global)）：

- 下载依赖包至缓存目录 `~/.npm`
- 从缓存目录拷贝到全局依赖目录 `{prefix}/lib/node_modules`
- 若全局依赖含 bin 命令，它们的可执行文件将软链接至目录 `{prefix}/bin`

其中 `prefix` 是 npm 的一个配置项（[详见](
https://docs.npmjs.com/cli/v10/configuring-npm/folders#prefix-configuration)），它的默认值与 Node 的安装位置有关，通常是 `/usr/local`。其中可执行文件是指依赖包 `package.json` 的 `bin` 字段。

```bash
$ npm config get prefix
/usr/local
```

> 若使用 nvm 来管理 Node 版本，**不建议**主动配置 `prefix`，否则可能会导致无法合理地安装依赖包到相应目录。

也就是说，默认情况下：

- 缓存目录 `~/.npm`
- 全局依赖目录 `/usr/local/lib/node_modules`
- 全局依赖的可执行文件目录 `/usr/local/bin`

相关命令：

```bash
$ npm root -g
/usr/local/lib/node_modules

$ npm bin -g
/usr/local/bin

$ npm list -g
/usr/local/lib
├── @google/gemini-cli@0.20.0
├── corepack@0.33.0
└── npm@10.9.3
```

> 自 npm v9 起，`npm bin` 命令已被移除。详见 [npm#5459](https://github.com/npm/cli/pull/5459)

### nvm

nvm（Node Version Manager）是 Node 版本管理工具。

> 注意，npm 并不是 Node Package Manager 的简写，[详见](https://github.com/npm/cli#is-npm-an-acronym-for-node-package-manager)

通常我们可能同时维护着多个项目，它们使用不同的 Node 版本，使用 nvm 将会更方便、高效地安装/切换 Node。安装请看[官方文档](https://github.com/nvm-sh/nvm)。

使用「传统」的方法安装 Node.js，其路径如下：

- node `/usr/local/bin/node`
- npm `/usr/local/bin/npm`
- 全局依赖 `/usr/local/lib/node_modules`

但如果使用 nvm 来管理 Node，这些都将会发生变化，相关内容将会默认存放至 `~/.nvm` 目录。

使用 `nvm install` 来安装 Node，它将会存放于 `~/.nvm/versions/node/v22.22.0` 目录：

```bash
$ nvm install 22.22.0
```

使用 `nvm use` 可以切换系统 Node 与 nvm 的 Node：

```bash
# 使用系统版本
$ nvm use system

# 使用 nvm 的 Node 版本，还有更多写法，请看：https://github.com/nvm-sh/nvm#usage
$ nvm use 22
```

对比下 `prefix` 的变化：

```bash
$ nvm use system
Now using system version of node: v22.18.0 (npm v10.9.3)

$ npm config get prefix
/usr/local

$ npm bin -g
/usr/local/bin

$ which node
/usr/local/bin/node
```

```bash
$ nvm use 22
Now using node v22.22.0 (npm v10.9.4)

$ npm config get prefix
~/.nvm/versions/node/v22.22.0

$ npm bin -g
~/.nvm/versions/node/v22.22.0/bin

$ which node
~/.nvm/versions/node/v22.22.0/bin/node
```

因此，在使用 nvm 管理的情况下：

- 全局依赖包将会安装至 `~/.nvm/versions/node/vX.Y.Z/lib/node_modules` 目录。
- 依赖包可执行文件将被软链接至 `~/.nvm/versions/node/vX.Y.Z/bin` 目录。

前面提到过，`prefix` 的默认位置与 Node 的安装路径有关。在 Unix/Linux/Mac 操作系统中，`prefix` 通常是 Node 安装路径的上一级，即 `~/.nvm/versions/node/vX.Y.Z` 目录。因此，当我们在切换 Node 版本中，它总能正确地安装到 `/usr/local/lib/node_modules` 或 `~/.nvm/versions/node/vX.Y.Z/lib/node_modules/` 目录。

> 了解更多 [NPM Docs](https://docs.npmjs.com/cli/v10/configuring-npm/folders#prefix-configuration)

如果在 `~/.npmrc` 中配置了 `prefix`，无论你如何切换 Node 版本，它总是被安装至所配置的路径下。

```bash
$ npm config set prefix "~/.npm-packages"

$ npm i -g jest

$ tree ~/.npm-packages -L 3 
/Users/frankie/.npm-packages
├── bin
│   └── jest -> ../lib/node_modules/jest/bin/jest.js
└── lib
    └── node_modules
        └── jest
```

这样就违背了用 nvm 的初心，自定义 `prefix` 配置与 nvm 不兼容。[了解更多](https://github.com/nvm-sh/nvm#important-notes)

> If you have an `~/.npmrc` file, make sure it does not contain any `prefix` settings (which is not compatible with `nvm`)

## 三、yarn classic 路径

### 缓存目录

使用 yarn add 安装依赖时，包会下载至全局缓存目录 `~/Library/Caches/Yarn/v6`。

```bash
$ yarn cache dir
~/Library/Caches/Yarn/v6
```

清空缓存：

```bash
$ yarn cache clean
```

### 全局依赖

安装全局依赖步骤：

- 下载依赖包至缓存目录 `~/Library/Caches/Yarn/v6`
- 从缓存目录拷贝到全局依赖目录 `~/.config/yarn/global/node_modules`
- 若全局依赖含 bin 命令，它们的可执行文件将软链接至目录 `/usr/local/bin`

相关命令：

```bash
$ yarn global dir
~/.config/yarn/global

$ yarn global bin
/usr/local/bin

$ yarn global list
yarn global v1.22.19
info "alfred-color-converter@0.0.11" has binaries:
   - alfred-color-converter-import
info "nrm@2.1.0" has binaries:
   - nrm
✨  Done in 0.07s.
```

> 自 yarn v2 起，`yarn global` 命令已被移除，替代方案是 `yarn dlx`。[了解更多](https://yarnpkg.com/migration/guide#use-yarn-dlx-instead-of-yarn-global)

## 四、pnpm 路径

### 全局缓存

使用 yarn add 安装依赖时，包会下载至全局缓存目录 `~/Library/pnpm/store/v10`。

但与 npm、yarn 不同的是，pnpm 的项目依赖、全局依赖跟全局缓存是通过「链接」方式进行关联的，而不是拷贝，好处是安装更快，更节省磁盘空间。

> 温馨提示：
>
> 由于 `pnpm remove` 不会主动清空全局缓存的依赖，随着时间积累、依赖升级等情况，难免会积累一些或许不会再用到的过时依赖，它会占据你的磁盘空间。你可以放心地使用 `pnpm store prune` 来清空那些没有被使用到的依赖。它是无害的，要是后续要用到此依赖，`pnpm install` 会重新下载缓存。[了解更多](https://pnpm.io/cli/store#prune)

- 缓存目录 `~/Library/pnpm/store`

```bash
$ pnpm store path
~/Library/pnpm/store/v10
```

### 全局依赖

- 全局依赖目录 `~/Library/pnpm/global`
- 全局依赖 bin 文件目录 `~/Library/pnpm`

相关命令：

```bash$ pnpm root -g
~/Library/pnpm/global/5/node_modules

$ pnpm bin -g
~/Library/pnpm
```

> 项目依赖存储路径也可以通过 `node_modules/.modules.yaml` 的 `storeDir` 查看。

> `pnpm config` 默认是全局的，若要修改项目配置，可以添加 `--location=project` 参数。[了解更多](https://pnpm.io/cli/config#--location)

另外，npm、yarn 的 `node_modules/.bin/` 的可执行文件是软链接，指向对应依赖的文件。但 pnpm 不太一样，它是一个 Shell 脚本（[详见](https://pnpm.io/limitations)），比如：

```
#!/bin/sh
basedir=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")

case `uname` in
    *CYGWIN*|*MINGW*|*MSYS*)
        if command -v cygpath > /dev/null 2>&1; then
            basedir=`cygpath -w "$basedir"`
        fi
    ;;
esac

if [ -z "$NODE_PATH" ]; then
  export NODE_PATH="/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/node_modules"
else
  export NODE_PATH="/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/node_modules:$NODE_PATH"
fi
if [ -x "$basedir/node" ]; then
  exec "$basedir/node"  "$basedir/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/eslint.js" "$@"
else
  exec node  "$basedir/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/eslint.js" "$@"
fi

```

它往 `NODE_PATH` 环境变量上添加可能的 `node_modules` 目录以确保依赖模块正确加载，然后通过 `$@` 将参数原样传递给实际脚本。

## 五、总结

目前，我同时使用着 nvm、npm、yarn、pnpm 等工具，个人建议：

- 非必要，一概不主动修改 npm、yarn、pnpm 默认安装路径
- 非必要，一概不在 `.npmrc` 设置 `prefix` 选项，以避免全局依赖包安装至“不正确”的路径
- ~~与 Node 版本有关的全局依赖包，统一用 npm 进行安装~~（不推荐）
- ~~与 Node 版本无关的全局依赖包，统一用 yarn 进行安装~~（不推荐）
- 尽可能少装全局依赖，善用 `npx`、`yarn dlx`、`pnpm dlx`（`pnpx`）、`pnpm create`、`yarn create` 等命令

全局依赖路径：

- `/usr/local/lib/node_modules`
- `~/.config/yarn/global/node_modules`
- `~/Library/pnpm/global/5/node_modules`
- `~/.nvm/versions/node/vX.X.X/lib/node_modules`

查看全局依赖路径的命令：

- `npm root -g`
- `yarn global dir`
- `pnpm root -g`

查看全局依赖的命令：

- `npm list -g`
- `yarn global list`
- `pnpm list -g`

查看全局依赖的 bin 文件目录路径的命令：

- ~~`npm bin -g`~~（自 npm v9 起不可用）
- `yarn global bin`
- `pnpm bin -g`
