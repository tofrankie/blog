---
title: 梳理 node、npm、yarn、pnpm 相关路径
number: '#94'
link: 'https://github.com/tofrankie/blog/issues/94'
created_at: '2023-02-25 20:27:18'
updated_at: '2026-01-21 18:34:05'
labels:
  - Node.js
  - '2022'
---
![配图源自 Freepik](https://cdn.jsdelivr.net/gh/tofrankie/blog@main/images/2025/12/1767110239450.png)

如果你对 node、npm、yarn、pnpm 全局安装路径存疑，混乱分不清，那么这篇文章或许能帮到你。

> 本文以 macOS 为例

## 一、which 命令

使用 `which` 命令可以查看可执行文件的路径。

需要注意的是，不同的安装方式，其路径是有差异的。

使用 .pkg 形式安装的 Node.js

```bash
$ which node npm yarn pnpm
/usr/local/bin/node
/usr/local/bin/npm
/usr/local/bin/yarn
/usr/local/bin/pnpm
```

> PS：`/usr/local/bin` 目录下的可执行文件多是软链接。

使用 Homebrew 安装的 Node.js

```bash
$ which node npm yarn pnpm
/usr/local/opt/node@22/bin/node
/usr/local/opt/node@22/bin/npm
/usr/local/opt/node@22/bin/pnpm
```

使用 nvm 安装的 Node.js

```bash
$ which node npm yarn pnpm
~/.nvm/versions/node/v22.18.0/bin/node
~/.nvm/versions/node/v22.18.0/bin/npm
~/.nvm/versions/node/v22.18.0/bin/yarn
~/.nvm/versions/node/v22.18.0/bin/pnpm
```

## 二、Node 路径

前往 [Node.js](https://nodejs.org/en/download/) 下载 .pkg 包并安装，完成会有如下提示：

> This package has installed:
>
> - Node.js v22.18.1 to `/usr/local/bin/node`
> - npm v10.9.3 to `/usr/local/bin/npm`
>
> Make sure that `/usr/local/bin` is in your `$PATH`.

PS：本文将以这种方式安装的 Node.js 称为系统版本的 Node，以区别使用 nvm 安装的 Node。

## 三、npm 路径

在 NPM 官方文档中，对「全局安装」如何存放文件都有比较清晰的描述（[详见](https://docs.npmjs.com/cli/v10/commands/npm-install#global)）。

简单来说：

- 依赖包将会下载至 `{prefix}/lib/node_modules` 目录下。
- 依赖包的可执行文件被软链接至 `{prefix}/bin` 目录。

其中 `prefix` 是 npm 的一个配置项（[详见](
https://docs.npmjs.com/cli/v10/configuring-npm/folders#prefix-configuration)），它的默认值与 Node 的安装位置有关。在 Unix/Linux/Mac 操作系统中，通常是 `/usr/local`。在 Windows 操作系统上通常是 `%AppData%\npm`。其中「可执行文件」是指 `package.json` 中 `bin` 字段的配置项。

使用 `npm config` 命令可对 `prefix` 配置进行操作：

```bash
# 查看
$ npm config get prefix
/usr/local

# 设置
$ npm config set prefix <value>

# 移除
$ npm config delete prefix
```

也可在配置文件 `~/.npmrc` 直接进行修改（[详见](https://docs.npmjs.com/cli/v10/configuring-npm/npmrc#files)）。

> 若你在使用 nvm 来管理 Node 版本，不建议主动配置 `prefix`。如果它存在的话应将其移除，否则可能会导致无法合理地安装依赖包到相应目录，具体原因下文会介绍。

结论：

- 依赖包存放于 `/usr/local/lib/node_modules` 目录。
- 依赖包可执行文件将被软链接至 `/usr/local/bin` 目录。

可通过以下命令查看：

```bash
$ npm root -g
/usr/local/lib/node_modules

$ npm bin -g
/usr/local/bin
```

> 自 npm v9 起，npm bin 已被移除，详见 [npm #5459](https://github.com/npm/cli/pull/5459)

可通过 `npm ls` 命令查看全局安装的依赖包，个人更喜欢使用其别名 `npm list`，原因是它跟 `yarn list` 一致。

```bash
$ npm list -g
/usr/local/lib
├── corepack@0.33.0
├── jest@28.1.1
├── npm@10.9.3
└── yarn@1.22.19
```

其打印结果为树状形式，可配合 `--depth=n` 参数使用以查看包的依赖信息，其中 `n` 表示树状深度。上述 `npm list -g` 相当于 `npm list -g --depth=0`。

> 了解更多 [NPM Docs](https://docs.npmjs.com/cli/v10/commands/npm-ls)

## 四、yarn (classic) 路径

> 插个话，在 yarn 2 版本有着较大的差异。比如，yarn 2 将 `yarn global` 命令移除，其替代者是 `yarn dlx`。[了解更多](https://yarnpkg.com/getting-started/migration/#use-yarn-dlx-instead-of-yarn-global)

yarn 全局安装路径：

- 依赖包存放于 `~/.config/yarn/global/node_modules` 目录。
- 依赖包可执行文件将被软链接至 `/usr/local/bin` 目录，

可通过以下命令查看：

```bash
$ yarn global dir
~/.config/yarn/global

$ yarn global bin
/usr/local/bin
```

若要修改以上配置，可通过 `yarn config` 命令处理：

```bash
# 修改依赖包安装路径
$ yarn config set global-folder <value>

# 修改依赖包可执行文件软链接路径
$ yarn config set prefix <value>
```

需要注意的是，修改全局安装路径的配置 `key` 是 `global-folder`，可执行文件的 `key` 为 `prefix`。别跟 npm 混淆了。

也可以在配置文件 `~/.yarnrc` 直接修改：

```.yarnrc
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1


registry "https://registry.npmmirror.com/"
lastUpdateCheck 1656144727204
```

需要注意的是，其中 npm 配置文件使用的是 ini-formatted 格式，也就是 `key=value` 形式，而 yarn 则是 `key "value"` 形式。

## 五、pnpm 路径

通过 pnpm 安装的依赖包都会统一缓存在某个全局目录下，而项目依赖、全局依赖只是全局缓存依赖的一个软链接。

> 温馨提示：
>
> 由于 `pnpm remove` 不会主动清空全局缓存的依赖，随着时间积累、依赖升级等情况，难免会积累一些或许不会再用到的过时依赖，它会占据你的磁盘空间。你可以放心地使用 pnpm store prune 来清空那些没有被使用到的依赖。它是无害的，要是后续要用到此依赖，`pnpm install` 会重新下载缓存。[了解更多](https://pnpm.io/cli/store#prune)

- `~/Library/pnpm/store` - 所有包实际存储路径
- `~/Library/pnpm/global` - 全局依赖的目录
- `~/Library/pnpm` - 全局依赖的 bin 文件目录

可通过以下命令查看：

```bash
$ pnpm store path
~/Library/pnpm/store/v10

$ pnpm root -g
~/Library/pnpm/global/5/node_modules

$ pnpm bin -g
~/Library/pnpm
```

可通过以下命令设置（获取用 `get` 同理）

```bash
# 全局设置
$ pnpm config set <key> <value>

# 项目设置
$ pnpm config set --location=project <key> <value>
```

上述三项对应的 `key` 分别是：`storeDir`、`globalDir`、`globalBinDir`。[了解更多](https://pnpm.io/settings)

我们知道，npm、yarn 的 node_modules/.bin 目录下的可执行文件，其实是实际文件的一个软链接，但 pnpm 下不太一样，因为 pnpm 的 node_modules 不是扁平的，

示例：

```
#!/bin/sh
basedir=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")

case `uname` in
    *CYGWIN*|*MINGW*|*MSYS*)
        if command -v cygpath > /dev/null 2>&1; then
            basedir=`cygpath -w "$basedir"`
        fi
    ;;
esac

if [ -z "$NODE_PATH" ]; then
  export NODE_PATH="/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/node_modules"
else
  export NODE_PATH="/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/eslint@8.57.1/node_modules:/Users/frankie/Library/pnpm/global/5/.pnpm/node_modules:$NODE_PATH"
fi
if [ -x "$basedir/node" ]; then
  exec "$basedir/node"  "$basedir/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/eslint.js" "$@"
else
  exec node  "$basedir/global/5/.pnpm/eslint@8.57.1/node_modules/eslint/bin/eslint.js" "$@"
fi

```

它往 `NODE_PATH` 环境变量上添加可能的 `node_modules` 目录以确保依赖模块正确加载，然后通过 `$@` 将参数原样传递给实际脚本。



## 六、使用 nvm

我们知道 npm（Node Package Manager）是 Node 包管理工具，而 nvm（Node Version Manager）则是 Node 版本管理工具。它可以通过命令行快速安装、使用不同版本的 Node。

假设有多个项目使用了不同版本的 Node，或者需要在不同版本的 Node 下测试开发的 npm 包，那么使用 nvm 将会更高效。安装方法请看[官方文档](https://github.com/nvm-sh/nvm)。

使用「传统」的方法安装 Node.js，其路径如下：

- Node 被安装到 `/usr/local/bin/node`；
- npm 被安装到 `/usr/local/bin/npm`；
- npm 全局依赖包默认存放于 `/usr/local/lib/node_modules` 目录。

但如果使用 nvm 来管理 Node，这些都将会发生变化，相关内容将会默认存放至 `~/.nvm` 目录。

使用 `nvm install` 来安装 Node，它将会存放于 `~/.nvm/versions/node/v22.22.0` 目录：

```bash
$ nvm install 22.22.0
```

使用 nvm use 可以切换系统 Node 与 nvm 的 Node：

```bash
# 使用系统版本
$ nvm use system

# 使用 nvm 的 Node 版本，还有更多写法，请看：https://github.com/nvm-sh/nvm#usage
$ nvm use 22
```

对比下 `prefix` 的变化：

```bash
$ nvm use system
Now using system version of node: v22.18.0 (npm v10.9.3)

$ npm config get prefix
/usr/local

$ npm bin -g
/usr/local/bin

$ which node
/usr/local/bin/node
```

```bash
$ nvm use 22
Now using node v22.22.0 (npm v10.9.4)

$ npm config get prefix
~/.nvm/versions/node/v22.22.0

$ npm bin -g
~/.nvm/versions/node/v22.22.0/bin

$ which node
~/.nvm/versions/node/v22.22.0/bin/node
```

因此，在使用 nvm 管理的情况下：

- 全局依赖包将会安装至 `~/.nvm/versions/node/vX.Y.Z/lib/node_modules` 目录。
- 依赖包可执行文件将被软链接至 `~/.nvm/versions/node/vX.Y.Z/bin` 目录。

前面提到过，`prefix` 的默认位置与 Node 的安装路径有关。在 Unix/Linux/Mac 操作系统中，`prefix` 通常是 Node 安装路径的上一级，即 `~/.nvm/versions/node/vX.Y.Z` 目录。因此，当我们在切换 Node 版本中，它总能正确地安装到 `/usr/local/lib/node_modules` 或 `~/.nvm/versions/node/vX.Y.Z/lib/node_modules/` 目录。

> 了解更多 [NPM Docs](https://docs.npmjs.com/cli/v10/configuring-npm/folders#prefix-configuration)

如果在 `~/.npmrc` 中配置了 `prefix`，无论你如何切换 Node 版本，它总是被安装至所配置的路径下。

```bash
$ npm config set prefix "~/.npm-packages"

$ npm i -g jest

$ tree ~/.npm-packages -L 3 
/Users/frankie/.npm-packages
├── bin
│   └── jest -> ../lib/node_modules/jest/bin/jest.js
└── lib
    └── node_modules
        └── jest
```

这样就违背了用 nvm 的初心，自定义 `prefix` 配置与 nvm 不兼容。[了解更多](https://github.com/nvm-sh/nvm#important-notes)

> If you have an `~/.npmrc` file, make sure it does not contain any `prefix` settings (which is not compatible with `nvm`)

## 七、总结

目前，我同时使用着 nvm、npm、yarn（classic）三个工具，平常是这样管理它们的：

- 非必要，一概不主动修改 npm、yarn、pnpm 默认安装路径
- 非必要，一概不在 `.npmrc` 设置 `prefix` 选项，以避免全局依赖包安装至“不正确”的路径
- ~~与 Node 版本有关的全局依赖包，统一用 npm 进行安装~~（不推荐）
- ~~与 Node 版本无关的全局依赖包，统一用 yarn 进行安装~~（不推荐）
- 尽可能少装全局依赖，善用 `npx`、`yarn dlx`、`pnpm dlx`（`pnpx`）、`pnpm create`、`yarn create` 等命令

基于这种情况下，全局安装的依赖路径如下：

- `/usr/local/lib/node_modules`
- `~/.config/yarn/global/node_modules`
- `~/Library/pnpm/global/5/node_modules`
- `~/.nvm/versions/node/vX.X.X/lib/node_modules`

查看全局依赖路径：

- `npm root -g`
- `yarn global dir`
- `pnpm root -g`

查看全局依赖：

- `npm list -g`
- `yarn global list`
- `pnpm list -g`

查看全局依赖的 bin 文件目录：

- ~~`npm bin -g`~~（自 npm v9 起不可用）
- `yarn global bin`
- `pnpm bin -g`

The end.
